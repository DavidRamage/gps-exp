#!/usr/bin/python
import pprint
import struct
import numpy as np
pp = pprint.PrettyPrinter()

def getGpsSignal():
	gpsData = []
	gpsFile = open('/home/david/gnss-dumpdata/2013_04_04_GNSS_SIGNAL_at_CTTC_SPAIN/gps_small.dat', 'r')
	while True:
		before = gpsFile.tell()
		gpsChunk = gpsFile.read(4)
		after = gpsFile.tell()
		if before == after:
			break
		(real,quad) = struct.unpack('HH', gpsChunk)
		gpsData.append(complex(real,quad))
	gpsFile.close()
	return gpsData

def getSD():
	rawSd =  [
		[  1,  63, 1023 -   5, ],
		[  2,  56, 1023 -   6, ],
		[  3,  37, 1023 -   7, ],
		[  4,  35, 1023 -   8, ],
		[  5,  64, 1023 -  17, ],
		[  6,  36, 1023 -  18, ],
		[  7,  62, 1023 - 139, ],
		[  8,  44, 1023 - 140, ],
		[  9,  33, 1023 - 141, ],
		[ 10,  38, 1023 - 251, ],
		[ 11,  46, 1023 - 252, ],
		[ 12,  59, 1023 - 254, ],
		[ 13,  43, 1023 - 255, ],
		[ 14,  49, 1023 - 256, ],
		[ 15,  60, 1023 - 257, ],
		[ 16,  51, 1023 - 258, ],
		[ 17,  57, 1023 - 469, ],
		[ 18,  50, 1023 - 470, ],
		[ 19,  54, 1023 - 471, ],
		[ 20,  47, 1023 - 472, ],
		[ 21,  52, 1023 - 473, ],
		[ 22,  53, 1023 - 474, ],
		[ 23,  55, 1023 - 509, ],
		[ 24,  23, 1023 - 512, ],
		[ 25,  24, 1023 - 513, ],
		[ 26,  26, 1023 - 514, ],
		[ 27,  27, 1023 - 515, ],
		[ 28,  48, 1023 - 516, ],
		[ 29,  61, 1023 - 859, ],
		[ 30,  39, 1023 - 860, ],
		[ 31,  58, 1023 - 861, ],
		[ 32,  22, 1023 - 862, ],
	]
	SD = []
	for raw in rawSd:
		SD.append({ 'PRN' : raw[0], 'Navstar' : raw[1], 'advance' : raw[2]})
	return SD

def getCaCode():
	rawCaCode = [
		[1,1], [1,1], [1,1], [1,1], [1,1], [1,1], [1,1], [1,1], [1,1], [1,1],
		[0,0], [0,0], [0,1], [1,0], [1,1], [1,1], [0,0], [0,1], [0,0], [1,0],
		[0,1], [0,0], [1,1], [1,0], [1,1], [0,1], [1,1], [1,1], [0,0], [0,1],
		[1,0], [0,1], [1,0], [0,0], [1,0], [1,0], [1,0], [0,1], [1,1], [1,1],
		[1,1], [1,1], [0,0], [1,1], [0,0], [1,1], [0,0], [0,1], [0,0], [1,1],
		[1,1], [1,0], [1,1], [0,0], [1,0], [0,0], [0,0], [1,0], [0,1], [1,0],
		[0,1], [1,0], [0,0], [0,1], [0,1], [0,1], [0,0], [1,1], [0,1], [1,1],
		[1,0], [1,0], [1,1], [1,0], [1,0], [1,0], [1,0], [0,1], [1,1], [0,0],
		[1,1], [0,0], [1,0], [0,0], [1,1], [0,1], [1,0], [1,0], [1,1], [1,1],
		[0,1], [1,1], [0,1], [0,0], [0,1], [0,1], [1,1], [1,1], [1,0], [0,1],
		[1,1], [0,0], [0,1], [1,0], [0,0], [0,1], [0,1], [1,1], [1,1], [0,0],
		[0,0], [1,1], [0,0], [1,1], [1,0], [0,0], [1,0], [0,1], [1,1], [1,1],
		[0,1], [0,0], [1,1], [1,1], [1,0], [1,0], [0,0], [1,1], [0,0], [1,0],
		[1,1], [0,0], [0,1], [0,1], [1,1], [1,1], [0,0], [0,1], [1,1], [1,1],
		[1,1], [1,1], [1,1], [1,0], [0,1], [0,0], [1,0], [0,1], [1,0], [0,0],
		[1,1], [0,0], [1,1], [0,1], [0,0], [1,1], [1,1], [0,0], [0,0], [1,1],
		[1,0], [0,0], [0,0], [1,0], [0,0], [1,1], [0,1], [0,0], [1,1], [1,0],
		[1,1], [1,0], [1,0], [0,0], [1,1], [0,0], [0,0], [1,0], [1,0], [1,1],
		[0,0], [0,1], [0,0], [0,0], [1,0], [0,1], [0,0], [0,1], [1,0], [1,1],
		[0,0], [1,1], [1,1], [0,1], [0,1], [1,1], [0,1], [0,1], [0,0], [1,1],
		[0,0], [1,1], [0,1], [0,1], [1,1], [1,0], [0,0], [1,0], [1,0], [1,1],
		[1,1], [0,0], [1,1], [1,1], [1,0], [0,1], [1,0], [0,0], [1,0], [0,1],
		[1,0], [1,0], [1,1], [0,0], [0,0], [1,1], [1,0], [0,0], [0,1], [1,1],
		[1,0], [1,0], [0,0], [1,1], [1,0], [1,1], [0,0], [1,1], [1,1], [1,1],
		[0,0], [0,0], [1,0], [1,1], [1,0], [0,0], [1,1], [0,1], [1,1], [0,0],
		[0,0], [1,0], [1,0], [1,0], [0,0], [1,0], [0,1], [0,0], [0,0], [0,1],
		[0,0], [1,1], [1,0], [1,1], [1,0], [0,1], [1,0], [1,1], [0,0], [1,0],
		[1,0], [1,1], [0,1], [0,0], [0,1], [0,1], [1,0], [1,0], [0,0], [0,1],
		[0,1], [1,0], [0,0], [0,1], [1,0], [0,1], [1,0], [0,0], [0,1], [1,1],
		[0,0], [1,0], [1,0], [0,0], [0,0], [1,0], [1,1], [0,0], [1,1], [0,0],
		[0,1], [0,1], [1,0], [0,0], [0,1], [0,1], [1,0], [0,0], [1,1], [1,0],
		[0,0], [1,1], [0,1], [0,1], [1,1], [0,1], [1,1], [1,0], [1,0], [0,1],
		[1,1], [0,1], [0,0], [1,1], [1,0], [0,0], [0,1], [0,0], [1,1], [0,1],
		[1,1], [1,0], [0,0], [0,0], [0,0], [0,0], [0,1], [0,0], [1,0], [0,1],
		[1,1], [0,1], [0,1], [1,0], [0,1], [0,1], [1,1], [0,0], [1,1], [1,0],
		[1,1], [1,0], [1,0], [0,1], [1,0], [1,1], [1,0], [1,0], [0,1], [0,0],
		[0,0], [1,1], [1,1], [0,1], [0,0], [0,1], [1,0], [1,1], [0,1], [1,1],
		[1,0], [1,0], [0,1], [1,1], [1,1], [0,1], [0,0], [0,1], [0,0], [1,1],
		[1,1], [1,0], [1,1], [0,1], [0,1], [1,1], [0,0], [0,0], [1,0], [1,1],
		[1,1], [0,0], [0,1], [1,0], [0,1], [1,1], [1,0], [0,1], [0,0], [0,1],
		[1,0], [0,1], [0,1], [0,0], [0,0], [1,0], [1,1], [0,1], [1,1], [1,0],
		[1,0], [1,1], [1,0], [1,0], [1,1], [0,0], [0,0], [1,0], [1,1], [1,1],
		[0,1], [0,1], [0,1], [1,1], [1,0], [0,1], [1,1], [0,0], [1,0], [0,1],
		[0,1], [1,1], [0,1], [1,0], [0,0], [0,0], [0,0], [0,0], [1,1], [0,1],
		[0,0], [0,0], [0,0], [1,0], [0,1], [0,1], [1,0], [0,0], [1,1], [1,1],
		[0,0], [1,1], [1,0], [1,1], [1,0], [1,1], [0,0], [1,0], [0,1], [1,1],
		[1,0], [1,1], [0,0], [0,1], [0,1], [1,1], [0,1], [1,1], [1,0], [1,1],
		[0,1], [0,0], [1,1], [0,1], [0,0], [0,0], [0,0], [1,0], [1,1], [1,1],
		[1,1], [1,0], [0,0], [1,0], [1,1], [0,1], [1,1], [0,0], [1,1], [0,1],
		[1,1], [0,1], [0,0], [0,0], [1,1], [0,1], [1,0], [1,1], [1,0], [1,0],
		[0,0], [1,0], [1,1], [0,1], [0,1], [1,0], [1,1], [1,0], [0,0], [0,0],
		[1,0], [1,0], [1,0], [1,0], [1,0], [0,1], [0,1], [0,1], [0,0], [0,0],
		[1,1], [1,1], [1,0], [0,0], [0,1], [1,1], [0,0], [0,0], [1,0], [0,0],
		[1,1], [0,0], [1,0], [1,1], [0,0], [0,0], [1,0], [0,0], [1,1], [1,0],
		[1,0], [1,0], [0,1], [0,1], [1,0], [0,0], [1,0], [1,1], [1,0], [0,0],
		[0,0], [0,0], [0,0], [0,0], [1,0], [0,1], [1,1], [0,0], [1,0], [1,1],
		[0,0], [1,0], [1,0], [0,1], [0,0], [1,0], [1,0], [0,1], [0,1], [0,1],
		[0,0], [1,1], [1,0], [0,1], [1,0], [0,1], [1,1], [1,1], [0,0], [1,1],
		[1,0], [1,0], [0,1], [1,1], [0,1], [0,0], [0,0], [1,1], [0,0], [1,1],
		[0,1], [1,1], [1,1], [1,1], [1,1], [1,0], [1,0], [0,0], [1,1], [0,0],
		[0,1], [0,0], [1,0], [1,1], [1,0], [0,1], [0,1], [1,0], [1,0], [0,1],
		[1,1], [1,1], [1,0], [0,0], [0,1], [1,1], [0,1], [1,0], [0,0], [0,0],
		[0,1], [1,0], [1,1], [0,1], [1,0], [0,0], [0,1], [0,0], [0,1], [0,1],
		[0,1], [1,0], [1,1], [0,0], [0,1], [1,1], [0,0], [0,0], [1,1], [0,0],
		[0,0], [0,1], [1,0], [0,1], [0,0], [0,0], [0,0], [0,0], [1,1], [0,0],
		[0,0], [1,1], [1,1], [0,0], [1,1], [1,1], [0,0], [1,0], [0,1], [0,1],
		[1,0], [1,1], [1,1], [1,1], [0,1], [0,0], [1,1], [1,0], [0,0], [1,0],
		[0,1], [1,1], [0,1], [1,0], [1,0], [0,0], [0,0], [0,1], [0,0], [1,1],
		[0,0], [1,1], [1,0], [1,0], [0,1], [1,0], [1,0], [0,0], [1,1], [0,0],
		[0,1], [0,0], [1,0], [1,0], [0,0], [0,0], [0,0], [0,1], [1,0], [0,0],
		[0,0], [1,0], [1,0], [1,1], [1,0], [1,0], [1,0], [1,1], [0,0], [1,0],
		[1,1], [1,1], [0,0], [0,0], [0,1], [1,1], [1,1], [1,0], [1,1], [0,1],
		[0,0], [0,0], [0,1], [0,0], [0,1], [1,0], [1,1], [1,1], [0,0], [1,1],
		[1,1], [0,0], [1,1], [1,1], [0,1], [0,1], [0,1], [1,0], [0,1], [1,0],
		[0,0], [0,0], [0,0], [1,1], [0,0], [0,1], [1,1], [1,0], [0,1], [0,0],
		[1,1], [0,1], [0,1], [0,0], [0,1], [0,1], [1,0], [1,0], [0,0], [1,0],
		[0,0], [0,1], [1,0], [0,1], [0,1], [1,0], [1,0], [1,0], [1,0], [0,0],
		[1,0], [1,0], [1,0], [1,0], [1,1], [0,0], [0,1], [0,1], [1,1], [0,0],
		[1,1], [0,1], [1,1], [0,0], [1,1], [1,1], [0,1], [1,1], [0,1], [0,0],
		[0,0], [0,0], [1,1], [0,1], [1,1], [0,1], [0,1], [0,0], [0,0], [0,0],
		[0,0], [0,1], [1,0], [0,0], [1,0], [1,0], [0,1], [1,1], [1,1], [0,1],
		[1,1], [1,1], [1,1], [1,1], [0,0], [0,1], [1,1], [1,1], [1,0], [1,0],
		[0,0], [0,0], [0,1], [1,1], [0,1], [0,1], [0,0], [1,1], [1,0], [1,0],
		[1,1], [1,1], [1,0], [0,0], [1,1], [1,0], [0,1], [0,1], [0,0], [1,0],
		[1,0], [1,1], [0,0], [1,1], [0,1], [1,1], [1,0], [0,0], [1,1], [0,0],
		[1,1], [0,0], [0,1], [0,0], [0,0], [1,0], [1,0], [0,1], [0,1], [1,0],
		[1,0], [0,0], [1,1], [1,1], [0,0], [0,1], [0,1], [0,1], [0,0], [1,1],
		[1,0], [0,0], [0,0], [0,1], [0,0], [0,1], [0,1], [0,1], [0,1], [1,0],
		[1,0], [0,1], [1,0], [1,0], [0,0], [1,1], [1,1], [0,0], [1,1], [0,0],
		[1,0], [1,1], [1,1], [0,0], [1,1], [0,1], [1,1], [1,0], [1,0], [1,0],
		[0,1], [0,1], [0,0], [0,0], [1,0], [0,0], [1,0], [0,1], [1,1], [0,1],
		[0,0], [1,1], [0,1], [0,0], [0,1], [0,1], [1,1], [0,0], [1,1], [1,1],
		[0,0], [0,1], [1,0], [0,1], [0,1], [1,0], [1,0], [0,0], [0,0], [0,1],
		[0,0], [0,1], [1,1], [0,1], [0,1], [0,1], [1,0], [0,0], [0,1], [1,1],
		[0,0], [0,0], [0,0], [0,1], [0,1], [0,1], [1,1], [0,0], [0,0], [0,1],
		[0,1], [0,1], [0,1], [0,1], [0,1], [0,1], [1,0], [0,0], [0,0], [1,0],
		[0,0], [0,0], [1,1], [0,1], [0,1], [1,1], [1,0], [0,0], [1,0], [0,1],
		[0,0], [1,0], [1,0], [0,1], [1,0], [0,1], [1,1], [1,0], [1,1], [1,1],
		[1,1], [0,0], [0,0], [1,1], [1,1], [0,0], [0,1], [0,1], [1,0], [1,1],
		[1,1], [1,0], [1,1], [0,0], [0,1], [1,0], [0,0], [0,1], [0,1], [1,1],
		[1,1], [1,1], [0,0], [1,0], [1,1], [1,0], [1,0], [1,1], [1,1], [0,0],
		[0,1], [0,0], [0,0], [1,1], [1,0], [1,0], [0,0], [0,0], [0,0], [0,0],
		[0,1], [0,1], [0,0]
	]

if __name__ == '__main__':
	sdStuff = getSD()
	gpsSignal = getGpsSignal()
	sampleFft = np.fft.fft(gpsSignal)
	pp.pprint(sampleFft)
